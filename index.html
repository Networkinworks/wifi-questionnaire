        <div class="form-group">
            <label for="userId">Your User ID:</label>
            <input type="text" id="userId" name="userId" placeholder="e.g., Name.lastname@databricks.com" required>
        </div>

        <div class="form-group">
            <label for="locationOffice">Location/Office:</label>
            <select id="locationOffice" name="locationOffice" required>
                <option value="">Select Location</option>
                <option value="AMS01">AMS01</option>
                <option value="BEL01">BEL01</option>
                <option value="BLR01">BLR01</option>
                <option value="CR01">CR01</option>
                <option value="GRU01">GRU01</option>
                <option value="LON02">LON02</option>
                <option value="MTV02">MTV02</option>
                <option value="MTV03">MTV03</option>
                <option value="MTV04">MTV04</option>
                <option value="NYC01">NYC01</option>
                <option value="SEA01">SEA01</option>
                <option value="SER01">SER01</option>
                <option value="SF01">SF01</option>
            </select>
        </div>

        <!-- Network Details -->
        <div class="form-group">
            <label>Which Wi-Fi network is having problems?</label>
            <div class="radio-group">
                <label><input type="radio" name="wifiNetwork" value="Corp" required> Corp</label>
                <label><input type="radio" name="wifiNetwork" value="Guest"> Guest</label>
                <label><input type="radio" name="wifiNetwork" value="Both"> Both</label>
                <label><input type="radio" name="wifiNetwork" value="Other"> Other</label>
                <input type="text" name="wifiNetworkOther" placeholder="Specify if 'Other'" class="ml-4 mt-2 p-2 border rounded-md text-sm hidden">
            </div>
            <!-- Conditional MAC Address Section for Guest -->
            <div id="macAddressSection" class="form-group ml-6 mt-3" style="display:none;">
                <label>Can you provide the MAC address of the affected device?</label>
                <div class="radio-group">
                    <label><input type="radio" name="provideMac" value="Yes"> Yes</label>
                    <label><input type="radio" name="provideMac" value="No"> No</label>
                </div>
                <div id="macAddressInputGroup" style="display:none;" class="mt-3">
                    <label for="macAddress">MAC Address:</label>
                    <input type="text" id="macAddress" name="macAddress" placeholder="e.g., AA:BB:CC:DD:EE:FF" pattern="^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$" title="Please enter a valid MAC address (e.g., AA:BB:CC:DD:EE:FF)">
                    <span class="mac-instructions-toggle"><b>Click here for instructions</b> on how to find your MAC address.</span>
                    <div class="mac-instructions-content">
                        <h4>How to find your MAC Address:</h4>
                        <p><strong>Windows:</strong> Open Command Prompt, type `ipconfig /all` and look for "Physical Address" under your Wi-Fi adapter.</p>
                        <p><strong>macOS:</strong> Go to System Settings &gt; Network &gt; Wi-Fi &gt; Details. The MAC address is listed as "Wi-Fi Address".</p>
                        <p><strong>Android:</strong> Go to Settings &gt; About phone &gt; Wi-Fi MAC address or Settings &gt; Network &amp; internet &gt; Wi-Fi &gt; Wi-Fi preferences &gt; Advanced &gt; MAC address.</p>
                        <p><strong>iOS (iPhone/iPad):</strong> Go to Settings &gt; Wi-Fi. Tap the 'i' icon next to the network name. The address is listed as "Wi-Fi Address". Note: iOS 14+ uses a "Private Wi-Fi Address" by default. Please disable this for the network if you want a stable MAC address.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Device Details -->
        <div class="form-group">
            <label>What device are you using?</label>
            <div class="radio-group">
                <label><input type="radio" name="deviceType" value="Laptop" required> Laptop</label>
                <label><input type="radio" name="deviceType" value="Phone"> Phone</label>
                <label><input type="radio" name="deviceType" value="Tablet"> Tablet</label>
                <label><input type="radio" name="deviceType" value="Other"> Other</label>
                <input type="text" name="deviceTypeOther" placeholder="Specify if 'Other'" class="ml-4 mt-2 p-2 border rounded-md text-sm hidden">
            </div>
            <div id="laptopOwnershipGroup" class="form-group ml-6 mt-3" style="display:none;">
                <label>Is this laptop company-owned or personal?</label>
                <div class="radio-group">
                    <label><input type="radio" name="laptopOwnership" value="Company-owned"> Company-owned</label>
                    <label><input type="radio" name="laptopOwnership" value="Personal"> Personal</label>
                </div>
            </div>
        </div>

        <!-- Issue Description -->
        <div class="form-group">
            <label>Is this issue new, or has it been happening for a while?</label>
            <div class="radio-group">
                <label><input type="radio" name="issueRecency" value="New (started recently)" required> New (started recently)</label>
                <label><input type="radio" name="issueRecency" value="Ongoing/intermittent"> Ongoing/intermittent</label>
            </div>
        </div>

        <div class="form-group">
            <label>What best describes the problem?</label>
            <div class="radio-group">
                <label><input type="radio" name="problemType" value="Frequent disconnects (Wi-Fi drops completely)" required> Frequent disconnects</label>
                <label><input type="radio" name="problemType" value="Slow performance/low bandwidth"> Slow performance</label>
                <label><input type="radio" name="problemType" value="Both"> Both</label>
            </div>
        </div>

        <div class="form-group">
            <label>Does this issue happen only in a specific area, or everywhere?</label>
            <div class="radio-group">
                <label><input type="radio" name="issueLocation" value="Specific area" required> Specific area</label>
                <label><input type="radio" name="issueLocation" value="Everywhere"> Everywhere</label>
            </div>
            <div id="specificAreaDescriptionGroup" class="form-group ml-6 mt-3" style="display:none;">
                <label for="specificAreaDescription">Please specify the area:</label>
                <textarea id="specificAreaDescription" name="specificAreaDescription" rows="2"></textarea>
            </div>
        </div>

        <div class="form-group">
            <label>Is this issue affecting others too, or just you (if you know)?</label>
            <div class="radio-group">
                <label><input type="radio" name="affectedOthers" value="Yes, others are affected"> Yes, others are affected</label>
                <label><input type="radio" name="affectedOthers" value="No, just me"> No, just me</label>
                <label><input type="radio" name="affectedOthers" value="Not sure" checked> Not sure</label>
            </div>
        </div>
        
         <div class="form-group">
            <label>Do any specific applications or activities (e.g., video calls) trigger the problem?</label>
            <div class="radio-group">
                <label><input type="radio" name="appTrigger" value="Yes" required> Yes</label>
                <label><input type="radio" name="appTrigger" value="No" checked> No</label>
            </div>
            <div id="specificAppActivityDescriptionGroup" class="form-group ml-6 mt-3" style="display:none;">
                <label for="specificAppActivityDescription">Specific App/Activity Description:</label>
                <textarea id="specificAppActivityDescription" name="specificAppActivityDescription" rows="2"></textarea>
            </div>
        </div>
        
        <!-- Troubleshooting Steps -->
        <h3 class="text-xl font-semibold mb-4 mt-8">Quick Checks</h3>
        <div class="form-group">
            <label>Have you restarted your device?</label>
            <div class="radio-group">
                <label><input type="radio" name="restartedDevice" value="Yes" required> Yes</label>
                <label><input type="radio" name="restartedDevice" value="No"> No</label>
            </div>
        </div>

        <div class="form-group">
            <label>Have you "forgotten" and reconnected to the Wi-Fi network?</label>
            <div class="radio-group">
                <label><input type="radio" name="forgottenNetwork" value="Yes" required> Yes</label>
                <label><input type="radio" name="forgottenNetwork" value="No"> No</label>
            </div>
        </div>
        
        <div class="form-group">
            <label>Have there been any recent changes to your device (e.g., updates, new software)?</label>
            <div class="radio-group">
                <label><input type="radio" name="recentDeviceChanges" value="Yes" required> Yes</label>
                <label><input type="radio" name="recentDeviceChanges" value="No" checked> No</label>
            </div>
            <div id="recentDeviceChangesDescriptionGroup" class="form-group ml-6 mt-3" style="display:none;">
                <label for="recentDeviceChangesDescription">Please describe the changes:</label>
                <textarea id="recentDeviceChangesDescription" name="recentDeviceChangesDescription" rows="2"></textarea>
            </div>
        </div>
        
        <!-- Availability -->
        <h3 class="text-xl font-semibold mb-4 mt-8">Availability for Troubleshooting</h3>
        <div class="form-group">
            <label>Can you be available for troubleshooting if needed?</label>
            <div class="radio-group">
                <label><input type="radio" name="canBeAvailable" value="Yes" required> Yes</label>
                <label><input type="radio" name="canBeAvailable" value="No"> No</label>
            </div>
            <div id="availabilityDetailsGroup" class="form-group ml-6 mt-3" style="display:none;">
                <div class="form-group">
                    <label for="availableDate">Preferred Date:</label>
                    <input type="date" id="availableDate" name="availableDate">
                </div>
                <div class="form-group">
                    <label for="availableTime">Preferred Time:</label>
                    <input type="time" id="availableTime" name="availableTime">
                </div>
                <div class="form-group">
                    <label for="timeZone">Time Zone:</label>
                    <select id="timeZone" name="timeZone">
                        <option value="">Select Time Zone</option>
                        <option value="America/Los_Angeles">(GMT-07:00) Pacific Time</option>
                        <option value="America/Denver">(GMT-06:00) Mountain Time</option>
                        <option value="America/Chicago">(GMT-05:00) Central Time</option>
                        <option value="America/New_York">(GMT-04:00) Eastern Time</option>
                        <option value="Europe/London">(GMT+01:00) London (BST)</option>
                        <option value="Europe/Paris">(GMT+02:00) Paris (CEST)</option>
                        <option value="Asia/Kolkata">(GMT+05:30) India Standard Time</option>
                        <option value="Asia/Shanghai">(GMT+08:00) China Standard Time</option>
                        <option value="Asia/Tokyo">(GMT+09:00) Japan Standard Time</option>
                        <option value="Australia/Sydney">(GMT+10:00) Australian Eastern Standard Time</option>
                        <option value="Pacific/Auckland">(GMT+12:00) New Zealand Standard Time</option>
                    </select>
                </div>
            </div>
        </div>

        <button type="submit">Submit Troubleshooting Request</button>
    </form>

    <div id="messageBox" class="message-box"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const wifiForm = document.getElementById('wifiForm');
        const messageBox = document.getElementById('messageBox');

        // --- Helper function to toggle sections ---
        function toggleSection(radioName, valueToShow, sectionId, requiredInputs = []) {
            document.querySelectorAll(`input[name="${radioName}"]`).forEach(radio => {
                radio.addEventListener('change', (event) => {
                    const section = document.getElementById(sectionId);
                    const isShown = event.target.value === valueToShow;
                    section.style.display = isShown ? 'block' : 'none';

                    requiredInputs.forEach(inputInfo => {
                       const elements = document.querySelectorAll(inputInfo.selector);
                       elements.forEach(el => {
                            if (isShown) {
                                el.setAttribute('required', 'required');
                            } else {
                                el.removeAttribute('required');
                                if (el.type === 'radio' || el.type === 'checkbox') {
                                    el.checked = false;
                                } else {
                                    el.value = '';
                                }
                            }
                       });
                    });
                });
            });
        }
        
        function toggleInputVisibility(radioName, valueToShow, inputSelector){
             document.querySelectorAll(`input[name="${radioName}"]`).forEach(radio => {
                radio.addEventListener('change', (event) => {
                    const inputField = document.querySelector(inputSelector);
                    const isShown = event.target.value === valueToShow;
                    inputField.classList.toggle('hidden', !isShown);
                    if (isShown) {
                        inputField.setAttribute('required', 'required');
                    } else {
                        inputField.removeAttribute('required');
                        inputField.value = '';
                    }
                });
            });
        }


        // --- Dynamic Display Logic ---
        
        // Show "Other" Wi-Fi network input
        toggleInputVisibility('wifiNetwork', 'Other', 'input[name="wifiNetworkOther"]');
        
        // Show "Other" Device type input
        toggleInputVisibility('deviceType', 'Other', 'input[name="deviceTypeOther"]');

        // Show MAC address section for "Guest" Wi-Fi
        toggleSection('wifiNetwork', 'Guest', 'macAddressSection', [{ selector: 'input[name="provideMac"]' }]);
        
        // Show MAC address input field
        toggleSection('provideMac', 'Yes', 'macAddressInputGroup', [{ selector: '#macAddress' }]);

        // Show Laptop Ownership section
        toggleSection('deviceType', 'Laptop', 'laptopOwnershipGroup', [{ selector: 'input[name="laptopOwnership"]' }]);
        
        // Show Specific Area description
        toggleSection('issueLocation', 'Specific area', 'specificAreaDescriptionGroup', [{ selector: '#specificAreaDescription' }]);
        
        // Show Specific App/Activity description
        toggleSection('appTrigger', 'Yes', 'specificAppActivityDescriptionGroup', [{ selector: '#specificAppActivityDescription' }]);
        
        // Show Recent Device Changes description
        toggleSection('recentDeviceChanges', 'Yes', 'recentDeviceChangesDescriptionGroup', [{ selector: '#recentDeviceChangesDescription' }]);

        // Show Availability details
        toggleSection('canBeAvailable', 'Yes', 'availabilityDetailsGroup', [
            { selector: '#availableDate' }, 
            { selector: '#availableTime' },
            { selector: '#timeZone' }
        ]);

        // MAC Instructions toggle
        document.querySelector('.mac-instructions-toggle').addEventListener('click', function() {
            const content = this.nextElementSibling;
            const isVisible = content.style.display === 'block';
            content.style.display = isVisible ? 'none' : 'block';
            this.innerHTML = isVisible ? '<b>Click here for instructions</b> on how to find your MAC address.' : '<b>Hide Instructions</b>';
        });

        // --- Form Submission Handler ---
        wifiForm.addEventListener('submit', function(e) {
            e.preventDefault(); // Prevent default form submission

            messageBox.style.display = 'none';
            messageBox.classList.remove('error');

            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            // Show a loading message
            messageBox.textContent = 'Submitting your request...';
            messageBox.classList.remove('error');
            messageBox.style.display = 'block';

            // This section is for Google Apps Script integration.
            // It will not work in a standalone HTML file preview.
            if (typeof google !== 'undefined' && google.script && google.script.run) {
                google.script.run
                    .withSuccessHandler(function(response) {
                        messageBox.textContent = 'Request submitted successfully! Thank you.';
                        wifiForm.reset();
                        
                        // Manually hide all dynamic sections after reset
                        document.querySelectorAll('[style*="display: block"]').forEach(el => {
                            if(el.id !== 'messageBox') el.style.display = 'none';
                        });
                        document.querySelectorAll('input.hidden').forEach(el => el.classList.add('hidden'));

                    })
                    .withFailureHandler(function(error) {
                        messageBox.textContent = 'Error submitting request: ' + error.message;
                        messageBox.classList.add('error');
                        console.error('Apps Script Error:', error);
                    })
                    .appendDataToSheet(data);
            } else {
                // Fallback for when not in Google Apps Script environment
                messageBox.textContent = 'Submission preview. This form requires a Google Apps Script backend to function.';
                messageBox.classList.add('error');
                console.log('Form data that would be submitted:', data);
            }
        });
    });
</script>
